<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œê¸€ ìƒì„¸</title>
    <link rel="stylesheet" href="css/board.css">
    <link rel="stylesheet" href="css/header.css">
</head>
<body>
    <!-- í—¤ë” ì˜ì—­ -->
    <header class="header">
        <div class="container">
            <div class="header-inner">
                <!-- ì™¼ìª½: ë¡œê³  -->
                <div class="logo-box">
                    <a href="/Mypage/Mypage.html" class="logo">Init.</a>
                </div>

                <!-- ê°€ìš´ë°: ë©”ë‰´ -->
                <nav class="nav-menu">
                    <a href="/MypageMain/Mypage_main.html" class="nav-item">Mypage</a>
                    <a href="/Resume/resume.html" class="nav-item">ì´ë ¥ì„œ</a>
                    <a href="/junyoung/101010 copy.html" class="nav-item">ìê¸°ì†Œê°œì„œ</a>
                    <a href="/calendar/calendar.html" class="nav-item">ê³µê³  ìº˜ë¦°ë”</a>
                    <a href="/community" class="nav-item">ì»¤ë®¤ë‹ˆí‹°</a>
                </nav>

                <!-- ì˜¤ë¥¸ìª½: ì•Œë¦¼/ìœ ì € -->
                <div class="navbar-right">
                    <button class="alarm-button">ğŸ””</button>
                    <button class="logout-button">ğŸ‘¤</button>
                </div>
            </div>
        </div>
    </header>

    <!-- ì•Œë¦¼ íŒ¨ë„ -->
    <div id="notification-panel" class="popup-panel" style="display: none;">
        <div class="popup-content">
            <p>ğŸ”” ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- ìœ ì € íŒ¨ë„ (ë¡œê·¸ì•„ì›ƒ ë“±) -->
    <div id="user-panel" class="popup-panel" style="display: none;">
        <div class="popup-content">
            <button class="logout-action">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
    <div class="container">
        <article class="post-detail">
            <div class="post-header">
                <h1 class="post-title" id="postTitle"></h1>
                <div class="post-meta">
                    <div class="post-author">
                        <span id="postAuthor"></span>
                        <span>â€¢</span>
                        <span id="postDate"></span>
                        <span>â€¢</span>
                        <span>ì¡°íšŒìˆ˜</span>
                        <span id="viewCount">0</span>
                    </div>
                    <div class="post-actions">
                        <button class="action-btn" onclick="toggleLike()">
                            <span>â¤ï¸</span>
                            <span id="likeCount">0</span>
                        </button>
                        <span class="action-btn">
                            <span>ğŸ’¬</span>
                            <span id="commentCount">0</span>
                        </span>
                    </div>
                </div>
            </div>

            <div class="post-content">
                <div id="postImageContainer">
                    <img id="postImage" class="post-image" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€" onclick="openModal(this.src)">
                </div>
                <div class="post-text" id="postContent"></div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="goToEdit()">ìˆ˜ì •</button>
                <button class="btn btn-danger" onclick="deletePost()">ì‚­ì œ</button>
                <button class="btn btn-secondary" onclick="goBack()">ëª©ë¡</button>
            </div>

            <div class="comments-section">
                <h3 class="comments-title">ëŒ“ê¸€ 0</h3>
                
                <div class="comment-form">
                    <textarea class="comment-textarea" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    <button class="comment-submit" onclick="submitComment()">ëŒ“ê¸€ ì‘ì„±</button>
                </div>
            </div>
        </article>
    </div>

    <!-- í‘¸í„° ì˜ì—­ -->
    <footer class="main-footer">
        <div class="footer-container">
            <div class="footer-logo">Init</div>
            <p>Â© 2025 ì´ë¦„ì¶”ì²œë°›ìŒ. All rights reserved.</p>
            <p>ë¬¸ì˜: gundo9918@gmail.com</p>
        </div>
    </footer>

    <!-- ì´ë¯¸ì§€ ëª¨ë‹¬ ì˜ì—­ -->
    <div id="imageModal" class="modal" onclick="closeModal()">
        <span class="modal-close">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²Œì‹œê¸€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        window.onload = function() {
            loadPost();
        }

        // ì¹´í…Œê³ ë¦¬ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
        function getCategoryName(category) {
            const categories = {
                'review': 'í›„ê¸°',
                'tip': 'íŒ',
                'info': 'ì •ë³´'
            };
            return categories[category] || category;
        }

        // ëŒ“ê¸€ ë¡œë“œ
        function loadComments() {
            const urlParams = new URLSearchParams(window.location.search);
            const postId = parseInt(urlParams.get('id'));
            const currentUser = localStorage.getItem('currentUser') || 'í˜„ì¬ ì‚¬ìš©ì';
            renderComments(postId, currentUser);
        }

        // ëŒ“ê¸€ ëª©ë¡ ë Œë”ë§
        function renderComments(postId, currentUser) {
            const comments = JSON.parse(localStorage.getItem(`comments_${postId}`) || '[]');
            const commentsContainer = document.querySelector('.comments-section');
            const commentsTitle = commentsContainer.querySelector('.comments-title');
            
            // ëŒ“ê¸€ ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
            commentsTitle.textContent = `ëŒ“ê¸€ ${comments.length}`;
            
            // ê¸°ì¡´ ëŒ“ê¸€ ëª©ë¡ ì œê±°
            const existingComments = commentsContainer.querySelectorAll('.comment');
            existingComments.forEach(comment => comment.remove());
            
            // ëŒ“ê¸€ ëª©ë¡ HTML ìƒì„±
            const commentsList = comments.map(comment => {
                const isAuthor = comment.author === currentUser;
                return `
                    <div class="comment" id="comment-${comment.id}">
                        <div class="comment-header">
                            <span class="comment-author">${comment.author}</span>
                            <span class="comment-date">${comment.date}</span>
                        </div>
                        <div class="comment-content" id="comment-content-${comment.id}">${comment.content}</div>
                        <div class="comment-edit-form" id="comment-edit-form-${comment.id}" style="display: none;">
                            <textarea class="comment-textarea" id="comment-edit-textarea-${comment.id}">${comment.content}</textarea>
                            <div class="comment-actions">
                                <button class="btn btn-primary" onclick="saveCommentEdit(${comment.id})">ì €ì¥</button>
                                <button class="btn btn-secondary" onclick="cancelCommentEdit(${comment.id})">ì·¨ì†Œ</button>
                            </div>
                        </div>
                        ${isAuthor ? `
                            <div class="comment-actions" id="comment-actions-${comment.id}">
                                <span class="comment-action-btn" onclick="startCommentEdit(${comment.id})">ìˆ˜ì •</span>
                                <span class="comment-action-btn" onclick="deleteComment(${comment.id})">ì‚­ì œ</span>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            // ëŒ“ê¸€ í¼ ë‹¤ìŒì— ëŒ“ê¸€ ëª©ë¡ ì‚½ì…
            const commentForm = commentsContainer.querySelector('.comment-form');
            commentForm.insertAdjacentHTML('afterend', commentsList);
        }

        // ëŒ“ê¸€ ìˆ˜ì • ì‹œì‘
        function startCommentEdit(commentId) {
            // ëŒ“ê¸€ ë‚´ìš©ê³¼ ìˆ˜ì • í¼ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
            document.getElementById(`comment-content-${commentId}`).style.display = 'none';
            document.getElementById(`comment-edit-form-${commentId}`).style.display = 'block';
            document.getElementById(`comment-actions-${commentId}`).style.display = 'none';
        }

        // ëŒ“ê¸€ ìˆ˜ì • ì·¨ì†Œ
        function cancelCommentEdit(commentId) {
            // ëŒ“ê¸€ ë‚´ìš©ê³¼ ìˆ˜ì • í¼ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
            document.getElementById(`comment-content-${commentId}`).style.display = 'block';
            document.getElementById(`comment-edit-form-${commentId}`).style.display = 'none';
            document.getElementById(`comment-actions-${commentId}`).style.display = 'flex';
        }

        // ëŒ“ê¸€ ìˆ˜ì • ì €ì¥
        function saveCommentEdit(commentId) {
            const urlParams = new URLSearchParams(window.location.search);
            const postId = parseInt(urlParams.get('id'));
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const post = posts.find(p => p.id === postId);
            
            if (post) {
                const comments = JSON.parse(localStorage.getItem(`comments_${postId}`) || '[]');
                const commentIndex = comments.findIndex(c => c.id === commentId);
                
                if (commentIndex !== -1) {
                    const newContent = document.getElementById(`comment-edit-textarea-${commentId}`).value.trim();
                    
                    if (newContent === '') {
                        alert('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    // ëŒ“ê¸€ ë‚´ìš© ì—…ë°ì´íŠ¸
                    comments[commentIndex].content = newContent;
                    comments[commentIndex].date = new Date().toLocaleString() + ' (ìˆ˜ì •ë¨)';
                    
                    localStorage.setItem(`comments_${postId}`, JSON.stringify(comments));
                    
                    // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì í™•ì¸
                    const currentUser = localStorage.getItem('currentUser') || 'í˜„ì¬ ì‚¬ìš©ì';
                    
                    // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    renderComments(postId, currentUser);
                }
            }
        }

        // ì¢‹ì•„ìš” í† ê¸€
        function toggleLike() {
            const urlParams = new URLSearchParams(window.location.search);
            const postId = parseInt(urlParams.get('id'));
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const post = posts.find(p => p.id === postId);
            
            if (post) {
                // ì¢‹ì•„ìš” ìƒíƒœ í† ê¸€
                const isLiked = document.querySelector('.action-btn').classList.contains('active');
                document.querySelector('.action-btn').classList.toggle('active');
                
                // ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸
                if (!isLiked) {
                    post.likes++;
                } else {
                    post.likes = Math.max(0, post.likes - 1); // ìŒìˆ˜ê°€ ë˜ì§€ ì•Šë„ë¡ ë³´í˜¸
                }
                
                // localStorage ì—…ë°ì´íŠ¸
                localStorage.setItem('posts', JSON.stringify(posts));
                
                // í™”ë©´ì— í‘œì‹œëœ ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸
                document.querySelector('#likeCount').textContent = post.likes;
            }
        }
        
        // ëŒ“ê¸€ ì‘ì„±
        function submitComment() {
            const textarea = document.querySelector('.comment-textarea');
            const content = textarea.value.trim();
            
            if (content === '') {
                alert('ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const urlParams = new URLSearchParams(window.location.search);
            const postId = parseInt(urlParams.get('id'));
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const post = posts.find(p => p.id === postId);
            
            if (post) {
                // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì í™•ì¸ (ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ì„¸ì…˜ ë“±ì„ í†µí•´ í™•ì¸)
                const currentUser = localStorage.getItem('currentUser') || 'í˜„ì¬ ì‚¬ìš©ì';
                
                // ëŒ“ê¸€ ë°ì´í„° ìƒì„±
                const comments = JSON.parse(localStorage.getItem(`comments_${postId}`) || '[]');
                const newComment = {
                    id: comments.length > 0 ? Math.max(...comments.map(c => c.id)) + 1 : 1,
                    author: currentUser,
                    date: new Date().toLocaleString(),
                    content: content
                };
                
                // ëŒ“ê¸€ ì¶”ê°€
                comments.push(newComment);
                localStorage.setItem(`comments_${postId}`, JSON.stringify(comments));
                
                // ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ ìˆ˜ ì—…ë°ì´íŠ¸
                post.comments = comments.length;
                localStorage.setItem('posts', JSON.stringify(posts));
                
                // ëŒ“ê¸€ ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
                document.querySelector('.action-btn:last-child').textContent = `ğŸ’¬ ${post.comments}`;
                
                // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                renderComments(postId, currentUser);
                
                // ì…ë ¥ì°½ ì´ˆê¸°í™”
                textarea.value = '';
            }
        }
        
        // ëŒ“ê¸€ ì‚­ì œ
        function deleteComment(commentId) {
            if (confirm('ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const urlParams = new URLSearchParams(window.location.search);
                const postId = parseInt(urlParams.get('id'));
                const posts = JSON.parse(localStorage.getItem('posts') || '[]');
                const post = posts.find(p => p.id === postId);
                
                if (post) {
                    // ëŒ“ê¸€ ì‚­ì œ
                    const comments = JSON.parse(localStorage.getItem(`comments_${postId}`) || '[]');
                    const updatedComments = comments.filter(c => c.id !== commentId);
                    localStorage.setItem(`comments_${postId}`, JSON.stringify(updatedComments));
                    
                    // ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ ìˆ˜ ì—…ë°ì´íŠ¸
                    post.comments = updatedComments.length;
                    localStorage.setItem('posts', JSON.stringify(posts));
                    
                    // ëŒ“ê¸€ ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
                    document.querySelector('.action-btn:last-child').textContent = `ğŸ’¬ ${post.comments}`;
                    
                    // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì í™•ì¸
                    const currentUser = localStorage.getItem('currentUser') || 'í˜„ì¬ ì‚¬ìš©ì';
                    
                    // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    renderComments(postId, currentUser);
                }
            }
        }
        
        // ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
        function goToEdit() {
            const postId = new URLSearchParams(window.location.search).get('id');
            window.location.href = `edit.html?id=${postId}`;
        }
        
        // ê²Œì‹œê¸€ ì‚­ì œ
        function deletePost() {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const urlParams = new URLSearchParams(window.location.search);
                const postId = parseInt(urlParams.get('id'));
                const posts = JSON.parse(localStorage.getItem('posts') || '[]');
                const updatedPosts = posts.filter(p => p.id !== postId);
                localStorage.setItem('posts', JSON.stringify(updatedPosts));
                
                // ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ë„ ì‚­ì œ
                localStorage.removeItem(`comments_${postId}`);
                
                alert('ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = 'board.html';
            }
        }
        
        // ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        function goBack() {
            window.location.href = 'board.html';
        }

        // ì´ë¯¸ì§€ ëª¨ë‹¬ ì—´ê¸°
        function openModal(imgSrc) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.style.display = "block";
            modalImg.src = imgSrc;
        }

        // ì´ë¯¸ì§€ ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('imageModal').style.display = "none";
        }

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                closeModal();
            }
        });

        // ì´ë¯¸ì§€ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('post-image')) {
                openModal(event.target.src);
            }
        });

        // ê²Œì‹œê¸€ ë°ì´í„° ë¡œë“œ
        function loadPost() {
            const urlParams = new URLSearchParams(window.location.search);
            const postId = parseInt(urlParams.get('id'));
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const post = posts.find(p => p.id === postId);

            if (post) {
                // ì¡°íšŒìˆ˜ ì¦ê°€
                post.views = (post.views || 0) + 1;
                localStorage.setItem('posts', JSON.stringify(posts));

                // ì œëª© ì„¤ì •
                document.getElementById('postTitle').textContent = post.title;
                
                // ì‘ì„±ì ì •ë³´ ì„¤ì •
                document.getElementById('postAuthor').textContent = post.author;
                document.getElementById('postDate').textContent = post.date;
                document.getElementById('viewCount').textContent = post.views;
                
                // ì¢‹ì•„ìš”, ëŒ“ê¸€ ìˆ˜ ì„¤ì •
                document.getElementById('likeCount').textContent = post.likes || 0;
                document.getElementById('commentCount').textContent = post.comments || 0;
                
                // ë‚´ìš© ì„¤ì •
                document.getElementById('postContent').innerHTML = post.content.replace(/\n/g, '<br>');
                
                // ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš° í‘œì‹œ
                const imageContainer = document.getElementById('postImageContainer');
                if (post.image) {
                    const img = document.getElementById('postImage');
                    img.src = post.image;
                    imageContainer.style.display = 'block';
                } else {
                    imageContainer.style.display = 'none';
                }

                // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì í™•ì¸
                const currentUser = localStorage.getItem('currentUser') || 'í˜„ì¬ ì‚¬ìš©ì';
                
                // ê²Œì‹œê¸€ ì‘ì„±ìì¸ ê²½ìš°ì—ë§Œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ í‘œì‹œ
                const actionButtons = document.querySelector('.action-buttons');
                if (post.author === currentUser) {
                    actionButtons.innerHTML = `
                        <button class="btn btn-primary" onclick="goToEdit()">ìˆ˜ì •</button>
                        <button class="btn btn-danger" onclick="deletePost()">ì‚­ì œ</button>
                        <button class="btn btn-secondary" onclick="goBack()">ëª©ë¡</button>
                    `;
                } else {
                    actionButtons.innerHTML = `
                        <button class="btn btn-secondary" onclick="goBack()">ëª©ë¡</button>
                    `;
                }

                // ëŒ“ê¸€ ëª©ë¡ í‘œì‹œ
                renderComments(postId, currentUser);
            } else {
                alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²Œì‹œê¸€ì…ë‹ˆë‹¤.');
                window.location.href = 'board.html';
            }
        }
    </script>
</body>
</html> 