<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="b">
    <!-- 전체게시글 조회 -->
    <select id="board_list" resultType="board" parameterType="java.util.Map">
        select * from board
        where del_info = 0
        order by ref desc, step asc
        limit #{start}, #{end}
    </select>

    <!-- 새 글 작성 -->
    <insert id="board_insert" parameterType="board">
        insert into board (
            name, subject, content, pwd, ip, regdate, readhit, ref, step, depth, del_info
        ) values (
            #{name}, #{subject}, #{content}, #{pwd}, #{ip}, NOW(), 0, #{ref}, #{step}, #{depth}, 0
        )
    </insert>

    <!-- idx에 해당하는 게시글 한 건 조회 -->
    <select id="board_one" parameterType="int" resultType="board">
        select * from board where idx=#{idx}
    </select>

    <!-- 조회수 증가 -->
    <update id="board_upd_readhit" parameterType="int">
        update board set readhit = readhit + 1 where idx=#{idx}
    </update>

    <!-- 기준글의 step보다 큰 값을 1씩 증가 -->
    <update id="board_upd_step" parameterType="board">
        update board set step = step + 1 where ref=#{ref} and step > #{step}
    </update>

    <!-- 게시글 삭제 -->
    <update id="board_del_upd" parameterType="int">
        update board set del_info = -1 where idx=#{idx}
    </update>

    <!-- 전체 게시글 수 -->
    <select id="board_count" resultType="int" parameterType="java.util.Map">
        select count(*) from board where del_info = 0
    </select>
</mapper> 